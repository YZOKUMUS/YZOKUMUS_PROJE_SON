rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Kullanıcı sadece kendi verilerine erişebilir
    // Document ID artık username olduğu için, document içindeki user_id alanını kontrol ediyoruz
    match /user_stats/{docId} {
      // Read: Document içindeki user_id alanı request.auth.uid ile eşleşmeli
      allow read: if request.auth != null && 
                  resource != null && 
                  resource.data.user_id == request.auth.uid;
      
      // Create: Yeni document oluşturulurken user_id alanı request.auth.uid ile eşleşmeli
      allow create: if request.auth != null && 
                    request.resource.data.user_id == request.auth.uid;
      
      // Update: Güncellemede de user_id alanı request.auth.uid ile eşleşmeli
      allow update: if request.auth != null && 
                    request.resource.data.user_id == request.auth.uid &&
                    resource.data.user_id == request.auth.uid;
    }
    
    match /daily_tasks/{docId} {
      // Read: Document içindeki user_id alanı request.auth.uid ile eşleşmeli
      allow read: if request.auth != null && 
                  resource != null && 
                  resource.data.user_id == request.auth.uid;
      
      // Create: Yeni document oluşturulurken user_id alanı request.auth.uid ile eşleşmeli
      allow create: if request.auth != null && 
                    request.resource.data.user_id == request.auth.uid;
      
      // Update: Güncellemede de user_id alanı request.auth.uid ile eşleşmeli
      allow update: if request.auth != null && 
                    request.resource.data.user_id == request.auth.uid &&
                    resource.data.user_id == request.auth.uid;
    }
    
    // Word stats (opsiyonel - şu an localStorage'da)
    match /word_stats/{userId} {
      // Sadece authenticated kullanıcılar kendi verilerini okuyabilir/yazabilir
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Weekly leaderboard (public read for ranking, authenticated write/delete for own data)
    match /weekly_leaderboard/{docId} {
      // Leaderboard herkes tarafından okunabilir (sıralama görmek için)
      // Bu normal bir durumdur - leaderboard'lar genellikle public'tir
      allow read: if true;
      
      // Sadece authenticated kullanıcılar kendi verilerini yazabilir/güncelleyebilir
      allow create, update: if request.auth != null && 
                             request.resource.data.user_id == request.auth.uid;
      
      // Sadece authenticated kullanıcılar kendi verilerini silebilir
      allow delete: if request.auth != null && 
                     resource != null && 
                     resource.data.user_id == request.auth.uid;
    }
    
    // Tüm diğer koleksiyonlar varsayılan olarak engellenir
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

